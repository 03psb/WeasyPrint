This document describes details that help understanding the WeasyPrint
implementation and may not be obvious by reading the source.

lxml proxy objects
------------------

Element python objects in lxml are only proxies to C space memory (libxml2 data
structures.) These objects may be created and destroyed at any time, so we can
generally not keep states in them. We would like however to store computed
styles in elements after applying CSS. This data is structured and can not fit
easily in attributes (whose values are strings.)

The lxml documentation[1] only gives one guarantee: if a reference to a proxy
object is kept, this same object will always be used and we can keep data there.
This is why we build a list of all elements in a document and keep it as an
attribute of the document object:

    document.proxy_cache = list(document.iter())

[1] http://lxml.de/element_classes.html#element-initialization
